<source>
  @type forward
  port 24224
  bind 0.0.0.0
  tag all
</source>

<filter all>
   @type record_transformer
   enable_ruby
   <record>
     pod_name ${record["kubernetes"]["pod_name"]}
   </record>
   <record>
     container_image ${record["kubernetes"]["container_image"]}
   </record>
   <record>
     container_name ${record["kubernetes"]["container_name"]}
   </record>
   <record>
     host ${record["kubernetes"]["host"]}
   </record>
   <record>
     namespace_name ${record["kubernetes"]["namespace_name"]}
   </record>
</filter>

<match all>
  @type sql
  host tidb.938cc73c.f30aa4c3.us-west-2.shared.aws.tidbcloud.com
  port 4000
  database slow_log_test
  adapter mysql2
  username root
  password 00000000

  <table>
    table slow_log_test
    column_mapping 'namespace_name:namespace_name,host:host,container_name:container_name,container_image:container_image,pod_name:pod_name,Time:time,Commit_time:commit_time,Compile_time:compile_time,Cop_time:cop_time,Optimize_time:optimize_time,Parse_time:parse_time,Process_time:process_time,Query_time:query_time,Wait_time:wait_time,DB:db,Digest:digest,Index_names:index_names,Plan:plan,Plan_digest:plan_digest,Statement:statement'
  </table>
</match>
